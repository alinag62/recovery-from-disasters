ADM2 <- subset(ADM2, select=c(ID_2))
ADM0 <- st_read(ADM0_path)
#load hurricane data and get unique hurricane IDs
hurr <- st_read(hurr_path)
crs <- st_crs(hurr)
hurr_unique <- unique(hurr$SID)
#load all hurricanes and subset by unique IDs for that country (to get full data on locations)
hurr_all <- st_read(hurr_all_path)
hurr_subset_by_id <- hurr_all[hurr_all$SID %in% hurr_unique,]
#clean hurr_subset_by_id
hurr_subset_by_id$ISO_TIME <- ISOdate(hurr_subset_by_id$year, hurr_subset_by_id$month, hurr_subset_by_id$day, hurr_subset_by_id$hour, hurr_subset_by_id$min)
hurr_subset_by_id <- subset(hurr_subset_by_id, TRACK_TYPE == "main")
hurr_subset_by_id$V_m <- hurr_subset_by_id$USA_WIND
names(hurr_subset_by_id)[names(hurr_subset_by_id) == "STORM_SPD"] <- "V_h"
hurr_subset_by_id <- st_drop_geometry(subset(hurr_subset_by_id, select=c("SID", "ISO_TIME","LON","LAT","V_m","V_h")))
#rm(hurr_all)
#load grids in a vector format (two of the same grids: I need to modify it but I need to use it later)
grid <- st_read(grid_vect_path)
grid <- st_transform(grid, crs = crs)
grid2 <- st_read(grid_vect_path)
grid2 <- st_transform(grid2, crs = crs)
#load grid in a raster format
gridRaster <- raster(grid_rast_path)
panel <- read.csv(paste(hurr_country_storms,"/maxWinds_with0.csv",sep=""))
View(panel)
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
View(ADM1)
View(panel)
View(grid2)
View(panel)
grid3 <- st_read(grid_vect_path)
grid3 <- st_transform(grid3, crs = crs)
grid3$site_latitude <- grid3$bottom+(grid3$top-grid3$bottom)/2
grid3$site_longitude <- grid3$left+(grid3$right-grid3$left)/2
View(grid3)
years<- rep(seq(year_min,year_max), dim(grid3)[1])
grid3$year <- years
View(grid3)
View(panel)
library(fasterize)
install.packages("fasterize")
library(fasterize)
View(ADM2)
View(ADM1)
rm(list=ls())
# load packages
#library(prob)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geosphere)
library(tidyverse)
library(readr)
library(raster)
library(sf)
library(exactextractr)
library(lubridate)
library(collapse)
library(terra)
library(fasterize)
#--------------------------------------------------#
# 0. Set data paths and several variables manually
#--------------------------------------------------#
path = "/Users/alinagafanova/Library/CloudStorage/Box-Box/recovery-from-disasters/"
#years for start and finish of the analysis (the same as hurricane data file)
year_min = 1987
year_max = 2013
#path to shape files of the country on 2 levels
ADM2_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/VNM_adm2.shp", sep="")
ADM0_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_0.shp", sep="")
#unique geographical ID in ADM2 shape file
ID_2 = "ID_2"
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): vector
grid_vect_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.shp", sep="")
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): raster
grid_rast_path = paste(path, "./data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.tif", sep="")
#path to country-specific hurricane data: shape file of hurricanes' eyes in 200km buffer (created in QGIS)
hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_2013_200km.shp", sep="")
#hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_1996_200km.shp", sep="")
#path to individual storm files and main hurricane folder for the country
hurr_ind_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam/csvs", sep="")
hurr_country_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam", sep="")
##########################
#NO MANUAL CHANGES BELOW
##########################
#path to all hurricane data
hurr_all_path = paste(path, "data/tropical-cyclones/raw/IBTrACS-points/IBTrACS.ALL.list.v04r00.points.shp", sep="")
#path to a main folder with various gpw population data
gpw_pop_main_path = paste(path, "data/population/intermediate/global_annual_gpw", sep="")
#--------------------------------------------------#
# 1. Load and clean data
#--------------------------------------------------#
setwd(path)
#load shape files
ADM2 <- st_read(ADM2_path)
ADM2 <- subset(ADM2, select=c(ID_2))
ADM0 <- st_read(ADM0_path)
#load hurricane data and get unique hurricane IDs
hurr <- st_read(hurr_path)
crs <- st_crs(hurr)
hurr_unique <- unique(hurr$SID)
#load all hurricanes and subset by unique IDs for that country (to get full data on locations)
hurr_all <- st_read(hurr_all_path)
hurr_subset_by_id <- hurr_all[hurr_all$SID %in% hurr_unique,]
#clean hurr_subset_by_id
hurr_subset_by_id$ISO_TIME <- ISOdate(hurr_subset_by_id$year, hurr_subset_by_id$month, hurr_subset_by_id$day, hurr_subset_by_id$hour, hurr_subset_by_id$min)
hurr_subset_by_id <- subset(hurr_subset_by_id, TRACK_TYPE == "main")
hurr_subset_by_id$V_m <- hurr_subset_by_id$USA_WIND
names(hurr_subset_by_id)[names(hurr_subset_by_id) == "STORM_SPD"] <- "V_h"
hurr_subset_by_id <- st_drop_geometry(subset(hurr_subset_by_id, select=c("SID", "ISO_TIME","LON","LAT","V_m","V_h")))
#rm(hurr_all)
#load grids in a vector format (two of the same grids: I need to modify it but I need to use it later)
grid <- st_read(grid_vect_path)
grid <- st_transform(grid, crs = crs)
grid2 <- st_read(grid_vect_path)
grid2 <- st_transform(grid2, crs = crs)
#load grid in a raster format
gridRaster <- raster(grid_rast_path)
rm(list=ls())
# load packages
#library(prob)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geosphere)
library(tidyverse)
library(readr)
library(raster)
library(sf)
library(exactextractr)
library(lubridate)
library(collapse)
library(terra)
library(fasterize)
#--------------------------------------------------#
# 0. Set data paths and several variables manually
#--------------------------------------------------#
path = "/Users/alinagafanova/Library/CloudStorage/Box-Box/recovery-from-disasters/"
#years for start and finish of the analysis (the same as hurricane data file)
year_min = 1987
year_max = 2013
#path to shape files of the country on 2 levels
ADM2_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/VNM_adm2.shp", sep="")
ADM0_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_0.shp", sep="")
#unique geographical ID in ADM2 shape file
ID_2 = "ID_2"
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): vector
grid_vect_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.shp", sep="")
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): raster
grid_rast_path = paste(path, "./data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.tif", sep="")
#path to country-specific hurricane data: shape file of hurricanes' eyes in 200km buffer (created in QGIS)
#hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_2013_200km.shp", sep="")
hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_1996_200km.shp", sep="")
hurr_ind_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam/csvs", sep="")
hurr_country_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam", sep="")
##########################
#NO MANUAL CHANGES BELOW
##########################
#path to all hurricane data
hurr_all_path = paste(path, "data/tropical-cyclones/raw/IBTrACS-points/IBTrACS.ALL.list.v04r00.points.shp", sep="")
#path to a main folder with various gpw population data
gpw_pop_main_path = paste(path, "data/population/intermediate/global_annual_gpw", sep="")
setwd(path)
#load shape files
ADM2 <- st_read(ADM2_path)
ADM2 <- subset(ADM2, select=c(ID_2))
ADM0 <- st_read(ADM0_path)
#load hurricane data and get unique hurricane IDs
hurr <- st_read(hurr_path)
crs <- st_crs(hurr)
hurr_unique <- unique(hurr$SID)
#load all hurricanes and subset by unique IDs for that country (to get full data on locations)
hurr_all <- st_read(hurr_all_path)
hurr_subset_by_id <- hurr_all[hurr_all$SID %in% hurr_unique,]
#clean hurr_subset_by_id
hurr_subset_by_id$ISO_TIME <- ISOdate(hurr_subset_by_id$year, hurr_subset_by_id$month, hurr_subset_by_id$day, hurr_subset_by_id$hour, hurr_subset_by_id$min)
hurr_subset_by_id <- subset(hurr_subset_by_id, TRACK_TYPE == "main")
hurr_subset_by_id$V_m <- hurr_subset_by_id$USA_WIND
names(hurr_subset_by_id)[names(hurr_subset_by_id) == "STORM_SPD"] <- "V_h"
hurr_subset_by_id <- st_drop_geometry(subset(hurr_subset_by_id, select=c("SID", "ISO_TIME","LON","LAT","V_m","V_h")))
#rm(hurr_all)
#load grids in a vector format (two of the same grids: I need to modify it but I need to use it later)
grid <- st_read(grid_vect_path)
grid <- st_transform(grid, crs = crs)
grid2 <- st_read(grid_vect_path)
grid2 <- st_transform(grid2, crs = crs)
#load grid in a raster format
gridRaster <- raster(grid_rast_path)
rm(list=ls())
# load packages
#library(prob)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geosphere)
library(tidyverse)
library(readr)
library(raster)
library(sf)
library(exactextractr)
library(lubridate)
library(collapse)
library(terra)
library(fasterize)
#--------------------------------------------------#
# 0. Set data paths and several variables manually
#--------------------------------------------------#
path = "/Users/alinagafanova/Library/CloudStorage/Box-Box/recovery-from-disasters/"
#years for start and finish of the analysis (the same as hurricane data file)
year_min = 1987
year_max = 2013
#path to shape files of the country on 2 levels
ADM2_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/VNM_adm2.shp", sep="")
ADM0_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_0.shp", sep="")
#unique geographical ID in ADM2 shape file
ID_2 = "ID_2"
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): vector
grid_vect_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.shp", sep="")
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): raster
grid_rast_path = paste(path, "./data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.tif", sep="")
#path to country-specific hurricane data: shape file of hurricanes' eyes in 200km buffer (created in QGIS)
#hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_2013_200km.shp", sep="")
hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_1996_200km.shp", sep="")
#path to individual storm files and main hurricane folder for the country
hurr_ind_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam/csvs", sep="")
hurr_country_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam", sep="")
##########################
#NO MANUAL CHANGES BELOW
##########################
#path to all hurricane data
hurr_all_path = paste(path, "data/tropical-cyclones/raw/IBTrACS-points/IBTrACS.ALL.list.v04r00.points.shp", sep="")
#path to a main folder with various gpw population data
gpw_pop_main_path = paste(path, "data/population/intermediate/global_annual_gpw", sep="")
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
grid3 <- st_read(grid_vect_path)
grid3 <- st_transform(grid3, crs = crs)
setwd(path)
#load shape files
ADM2 <- st_read(ADM2_path)
ADM2 <- subset(ADM2, select=c(ID_2))
ADM0 <- st_read(ADM0_path)
#load hurricane data and get unique hurricane IDs
hurr <- st_read(hurr_path)
crs <- st_crs(hurr)
grid3 <- st_transform(grid3, crs = crs)
panel <- read.csv(paste(hurr_country_storms,"/maxWinds_with0.csv",sep=""))
View(ADM1)
list <- nrow(ADM1)
list
list <- seq(1, nrow(ADM1))
hurr <- ADM1[with(ADM1, order(GID_1)),]
ADM1 <- ADM1[with(ADM1, order(GID_1)),]
View(ADM1)
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
grid3 <- st_read(grid_vect_path)
grid3 <- st_transform(grid3, crs = crs)
panel <- read.csv(paste(hurr_country_storms,"/maxWinds_with0.csv",sep=""))
ADM1$ID_1 <- seq(1, nrow(ADM1))
View(ADM1)
ADM1 <- subset(ADM1, select=c(ID_1))
View(ADM1)
adm1_raster <- fasterize(ADM1, grid3, fiels = ID_1)
adm1_raster <- fasterize(ADM1, grid3, field = ID_1)
adm1_raster <- fasterize(ADM1, grid3, field = "ID_1")
rm(list=ls())
# load packages
#library(prob)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geosphere)
library(tidyverse)
library(readr)
library(raster)
library(sf)
library(exactextractr)
library(lubridate)
library(collapse)
library(terra)
library(fasterize)
#--------------------------------------------------#
# 0. Set data paths and several variables manually
#--------------------------------------------------#
path = "/Users/alinagafanova/Library/CloudStorage/Box-Box/recovery-from-disasters/"
#years for start and finish of the analysis (the same as hurricane data file)
year_min = 1987
year_max = 2013
#path to shape files of the country on 2 levels
ADM2_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/VNM_adm2.shp", sep="")
ADM0_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_0.shp", sep="")
#unique geographical ID in ADM2 shape file
ID_2 = "ID_2"
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): vector
grid_vect_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.shp", sep="")
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): raster
grid_rast_path = paste(path, "./data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.tif", sep="")
#path to country-specific hurricane data: shape file of hurricanes' eyes in 200km buffer (created in QGIS)
#hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_2013_200km.shp", sep="")
hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_1996_200km.shp", sep="")
#path to individual storm files and main hurricane folder for the country
hurr_ind_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam/csvs", sep="")
hurr_country_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam", sep="")
##########################
#NO MANUAL CHANGES BELOW
##########################
#path to all hurricane data
hurr_all_path = paste(path, "data/tropical-cyclones/raw/IBTrACS-points/IBTrACS.ALL.list.v04r00.points.shp", sep="")
#path to a main folder with various gpw population data
gpw_pop_main_path = paste(path, "data/population/intermediate/global_annual_gpw", sep="")
#--------------------------------------------------#
# 1. Load and clean data
#--------------------------------------------------#
setwd(path)
#load shape files
ADM2 <- st_read(ADM2_path)
ADM2 <- subset(ADM2, select=c(ID_2))
ADM0 <- st_read(ADM0_path)
#load hurricane data and get unique hurricane IDs
hurr <- st_read(hurr_path)
crs <- st_crs(hurr)
hurr_unique <- unique(hurr$SID)
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
grid3 <- st_read(grid_vect_path)
grid3 <- st_transform(grid3, crs = crs)
# load coordinate-year-level winds
panel <- read.csv(paste(hurr_country_storms,"/maxWinds_with0.csv",sep=""))
#change IDs for ADM1
ADM1$ID_1 <- seq(1, nrow(ADM1))
ADM1 <- subset(ADM1, select=c(ID_1))
View(ADM1)
View(ADM1)
ADM1 <- st_read(ADM1_path)
adm1_raster <- fasterize(ADM1, grid3, field = GID_1)
adm1_raster <- fasterize(ADM1, grid3, field = "GID_1")
type(ADM1)
typeof(ADM1)
as_Spatial(ADM1)
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
grid3 <- st_read(grid_vect_path)
grid3 <- st_transform(grid3, crs = crs)
ADM1$ID_1 <- seq(1, nrow(ADM1))
ADM1 <- subset(ADM1, select=c(ID_1))
ADM1 <- as_Spatial(ADM1)
View(ADM2)
View(ADM0)
View(ADM1)
adm1_raster <- fasterize(ADM1, grid3, field = ID_1)
View(ADM1)
adm1_raster <- fasterize(ADM1, grid3, field = "ID_1")
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
ADM1$ID_1 <- seq(1, nrow(ADM1))
ADM1 <- subset(ADM1, select=c(ID_1))
ADM1
gridRaster2 <- raster(grid_rast_path)
adm1_raster <- fasterize(ADM1, gridRaster2, field = ID_1)
adm1_raster <- fasterize(ADM1, gridRaster2, field = "ID_1")
View(adm1_raster)
adm1_raster_df <- as.data.frame(adm1_raster, xy=TRUE, centroids=TRUE)
View(adm1_raster_df)
View(adm1_raster)
unique(adm1_raster_df$layer)
adm1_raster_df <- as.data.frame(adm1_raster, xy=TRUE, centroids=TRUE, col.names = "ID_1")
View(adm1_raster_df)
adm1_raster_df <- as.data.frame(adm1_raster, xy=TRUE, centroids=TRUE, col.names = c("ID_1"))
View(adm1_raster_df)
View(adm1_raster)
plot(adm1_raster)
adm1_raster_df <- adm1_raster_df[!is.na(adm1_raster_df$layer),]
View(adm1_raster_df)
unique(adm1_raster_df$layer)
len(unique(adm1_raster_df$layer))
length(unique(adm1_raster_df$layer))
View(panel)
rm(list=ls())
# load packages
#library(prob)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geosphere)
library(tidyverse)
library(readr)
library(raster)
library(sf)
library(exactextractr)
library(lubridate)
library(collapse)
library(terra)
library(fasterize)
#--------------------------------------------------#
# 0. Set data paths and several variables manually
#--------------------------------------------------#
path = "/Users/alinagafanova/Library/CloudStorage/Box-Box/recovery-from-disasters/"
#years for start and finish of the analysis (the same as hurricane data file)
year_min = 1987
year_max = 2013
#path to shape files of the country on 2 levels
ADM2_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/VNM_adm2.shp", sep="")
ADM0_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_0.shp", sep="")
#unique geographical ID in ADM2 shape file
ID_2 = "ID_2"
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): vector
grid_vect_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.shp", sep="")
#path to a 0.1x0.1deg grid for a country and its 200km buffer (created in QGIS): raster
grid_rast_path = paste(path, "./data/tropical-cyclones/intermediate/Vietnam/grid_0p1deg.tif", sep="")
#path to country-specific hurricane data: shape file of hurricanes' eyes in 200km buffer (created in QGIS)
#hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_2013_200km.shp", sep="")
hurr_path = paste(path, "data/tropical-cyclones/intermediate/Vietnam/subset_1987_1996_200km.shp", sep="")
#path to individual storm files and main hurricane folder for the country
hurr_ind_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam/csvs", sep="")
hurr_country_storms = paste(path, "data/tropical-cyclones/intermediate/Vietnam", sep="")
##########################
#NO MANUAL CHANGES BELOW
##########################
#path to all hurricane data
hurr_all_path = paste(path, "data/tropical-cyclones/raw/IBTrACS-points/IBTrACS.ALL.list.v04r00.points.shp", sep="")
#path to a main folder with various gpw population data
gpw_pop_main_path = paste(path, "data/population/intermediate/global_annual_gpw", sep="")
#--------------------------------------------------#
# 1. Load and clean data
#--------------------------------------------------#
setwd(path)
#load shape files
ADM2 <- st_read(ADM2_path)
ADM2 <- subset(ADM2, select=c(ID_2))
ADM0 <- st_read(ADM0_path)
hurr <- st_read(hurr_path)
crs <- st_crs(hurr)
hurr_unique <- unique(hurr$SID)
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
gridRaster2 <- raster(grid_rast_path)
# load coordinate-year-level winds
panel <- read.csv(paste(hurr_country_storms,"/maxWinds_with0.csv",sep=""))
#change IDs for ADM1
ADM1$ID_1 <- seq(1, nrow(ADM1))
ADM1 <- subset(ADM1, select=c(ID_1))
#rasterize shapefile with ADM1 to the grid
adm1_raster <- fasterize(ADM1, gridRaster2, field = "ID_1")
adm1_raster_df <- as.data.frame(adm1_raster, xy=TRUE, centroids=TRUE)
adm1_raster_df <- adm1_raster_df[!is.na(adm1_raster_df$layer),]
plot(adm1_raster)
?read.csv
?merge
names(adm1_raster_df)[names(adm1_raster_df) == "x"] <- "site_longitude"
names(adm1_raster_df)[names(adm1_raster_df) == "y"] <- "site_latitude"
hurr_by_adm1 <- merge(panel, adm1_raster_df, by = c("site_longitude", "site_latitude"), all.y=TRUE)
hurr_by_adm1 <- merge(panel, adm1_raster_df, by = c("site_longitude", "site_latitude"))
View(hurr_by_adm1)
View(hurr_by_adm1)
hurr_by_adm1 <- subset(hurr_by_adm1, select=-c("site_longitude", "site_latitude", "X"))
hurr_by_adm1 <- subset(hurr_by_adm1, select=-c(site_longitude, site_latitude, X))
View(panel)
View(hurr_by_adm1)
ADM1_path = paste(path, "data/firm-data/Vietnam/gadm36_VNM_shp/gadm36_VNM_1.shp", sep="")
ADM1 <- st_read(ADM1_path)
ADM1 <- subset(ADM1, select=c(GID_1))
gridRaster2 <- raster(grid_rast_path)
# load coordinate-year-level winds
panel <- read.csv(paste(hurr_country_storms,"/maxWinds_with0.csv",sep=""))
#change IDs for ADM1
ADM1$ID_1 <- seq(1, nrow(ADM1))
ADM1 <- subset(ADM1, select=c(ID_1))
#rasterize shapefile with ADM1 to the grid
adm1_raster <- fasterize(ADM1, gridRaster2, field = "ID_1")
adm1_raster_df <- as.data.frame(adm1_raster, xy=TRUE, centroids=TRUE)
adm1_raster_df <- adm1_raster_df[!is.na(adm1_raster_df$layer),]
#rename columns to match
names(adm1_raster_df)[names(adm1_raster_df) == "x"] <- "site_longitude"
names(adm1_raster_df)[names(adm1_raster_df) == "y"] <- "site_latitude"
#merge winds with the rasterized file
hurr_by_adm1 <- merge(panel, adm1_raster_df, by = c("site_longitude", "site_latitude"), all.y=TRUE)
hurr_by_adm1 <- subset(hurr_by_adm1, select=-c(site_longitude, site_latitude, X))
names(hurr_by_adm1)[names(hurr_by_adm1) == "layer"] <- "ID_1"
View(hurr_by_adm1)
View(hurr_by_adm1)
maxs_adm1 <- hurr_by_adm1 %>%
group_by(year, ID_1) %>%
mutate(weighted_V_s = weighted.mean(V_s, coverage_fraction,na.rm=TRUE),
weighted_storm = weighted.mean(storm, coverage_fraction,na.rm=TRUE),
weighted_one = weighted.mean(one, coverage_fraction,na.rm=TRUE),
weighted_two = weighted.mean(two, coverage_fraction,na.rm=TRUE),
weighted_three = weighted.mean(three, coverage_fraction,na.rm=TRUE),
weighted_four = weighted.mean(four, coverage_fraction,na.rm=TRUE),
weighted_five = weighted.mean(five, coverage_fraction,na.rm=TRUE))
maxs_adm1 <- hurr_by_adm1 %>%
group_by(year, ID_1) %>%
mutate(weighted_V_s = mean(V_s,na.rm=TRUE),
weighted_storm = mean(storm,na.rm=TRUE),
weighted_one = mean(one,na.rm=TRUE),
weighted_two = mean(two,na.rm=TRUE),
weighted_three = mean(three,na.rm=TRUE),
weighted_four = mean(four,na.rm=TRUE),
weighted_five = mean(five,na.rm=TRUE))
View(maxs_adm1)
maxs_adm1 <- subset(maxs_adm1, select = -c(V_s, storm, one, two, three, four, five))
View(maxs_adm1)
maxs_adm1 <- distinct(maxs_adm1)
write.csv(maxs_adm1, file = paste(hurr_country_storms,"/maxWindsADM1.csv",sep=""))
